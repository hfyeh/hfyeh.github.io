<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>gil - sharefun</title><meta name=description content><meta name=author content><link rel="preload stylesheet" href=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.css><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]]}}</script><script id=MathJax-script defer src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<link rel="preload stylesheet" href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/gruvbox-dark.min.css><script defer src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon type=image/x-icon href=https://hfyeh.github.io/images/favicon.ico><link rel=apple-touch-icon href=https://hfyeh.github.io/images/apple-touch-icon-dark.png><link rel=stylesheet href=https://hfyeh.github.io/stylesheets/dark.css><link rel="preload stylesheet" as=style href=https://hfyeh.github.io/custom.min.css><meta name=generator content="Hugo 0.107.0"><link rel=alternate type=application/rss+xml href=https://hfyeh.github.io/tags/gil/index.xml title=sharefun><meta property="og:title" content="gil"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://hfyeh.github.io/tags/gil/"><meta itemprop=name content="gil"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="gil"><meta name=twitter:description content></head><body><div class="grid grid-centered"><div class=grid-cell><nav class="header-nav scrollappear"><a href=/ class=header-logo title=sharefun>sharefun</a><ul class=header-links><li><a href=https://www.facebook.com/sharefun010407 rel="noreferrer noopener" target=_blank title=Facebook><svg xmlns="http://www.w3.org/2000/svg" class="icon-facebook"><use href="https://hfyeh.github.io/icons/facebook.svg#icon-facebook" xlink:href="https://hfyeh.github.io/icons/facebook.svg#icon-facebook"/></svg></a></li><li><a href=https://github.com/hfyeh rel="noreferrer noopener" target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon-github"><use href="https://hfyeh.github.io/icons/github.svg#icon-github" xlink:href="https://hfyeh.github.io/icons/github.svg#icon-github"/></svg></a></li><li><a href=https://twitter.com/SharefunYeh rel="noreferrer noopener" target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter"><use href="https://hfyeh.github.io/icons/twitter.svg#icon-twitter" xlink:href="https://hfyeh.github.io/icons/twitter.svg#icon-twitter"/></svg></a></li></ul></nav><ul class=article-list><li class="article-list-item scrollappear"><h2><a href=https://hfyeh.github.io/posts/a-minimal-example-of-concurrent-python/ title="A Minimal Example of Concurrent Python">A Minimal Example of Concurrent Python</a></h2><div class=article-list-header><span class=article-list-date>April 22, 2022</span></div><p><p>The CPython interpreter usese <a href=https://wiki.python.org/moin/GlobalInterpreterLock>GIL</a> (global interpreter lock), to prevent threads from executing Python bytecodes at once.</p><p>Suppose I have two components who need to be run in parallel in a modern multi-core processor. Say, <code>add</code> and <code>mul</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(n: int) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>        result <span style=color:#f92672>+=</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>mul</span>(n: int) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Run many times to get longer execution period</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4000000</span>):
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(n):
</span></span><span style=display:flex><span>            result <span style=color:#f92672>*=</span> (i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result
</span></span></code></pre></div><p>Impose that these two tiny components have to be run sequentially, <code>mul</code> recieves <code>add</code>&rsquo;s output.</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant main
    participant mul
    participant add
    main-&gt;&gt;mul: For every stdin
    activate main
    mul-&gt;&gt;add: result
    add-&gt;&gt;mul: 
    mul-&gt;&gt;main: 
    deactivate main
</code></pre><p>Run it twice and fix the input of <code>mul</code> to be 11 for demonstration purpose. Note here I print the time log to the standard error on purpose. The code is listed below.</p><div class=article-list-read-more><a href=https://hfyeh.github.io/posts/a-minimal-example-of-concurrent-python/ title="Read more" class=article-list-read-more>Read more<svg xmlns="http://www.w3.org/2000/svg" class="icon-arrow-right"><use href="https://hfyeh.github.io/icons/arrow-right.svg#icon-arrow-right" xlink:href="https://hfyeh.github.io/icons/arrow-right.svg#icon-arrow-right"/></svg></a></div></p></p></li></ul></div><footer class="footer scrollappear"><p><span>&copy; 2022 <a href=https://hfyeh.github.io>sharefun</a></span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></span>
<span>Theme is based on <a href=https://github.com/nielsenramon/chalk rel="noreferrer noopener" target=_blank>Chalk</a></span></p></footer><script>var config={startOnLoad:!0,theme:"forest",classDiagram:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.mermaid.init(void 0,document.querySelectorAll(".language-mermaid"))</script><style>.language-mermaid>svg{background-color:#e8e8e8}</style></div></div></main><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script>
<script src=https://hfyeh.github.io/javascripts/zooming.min.js></script>
<script src=https://hfyeh.github.io/javascripts/retina.min.js></script>
<script src=https://hfyeh.github.io/javascripts/svgxuse.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js></script>
<script src=https://hfyeh.github.io/javascripts/vendor.min.js></script>
<script src=https://hfyeh.github.io/javascripts/webfonts.min.js></script>
<script src=https://hfyeh.github.io/javascripts/scrollappear.min.js></script>
<script src=https://hfyeh.github.io/javascripts/application.min.js></script></body></html>